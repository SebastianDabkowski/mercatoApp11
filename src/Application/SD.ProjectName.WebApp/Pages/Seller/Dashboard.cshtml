@page
@using Microsoft.AspNetCore.Authorization
@using SD.ProjectName.WebApp.Identity
@attribute [Authorize(Roles = AccountTypes.Seller)]
@model SD.ProjectName.WebApp.Pages.Seller.DashboardModel
@{
    ViewData["Title"] = "Seller dashboard";
}

<h1 class="display-6">Seller dashboard</h1>
<p class="lead">Manage your listings and track buyer activity.</p>

@if (Model.InternalUsersEnabled && Model.IsStoreOwner)
{
    <div class="alert alert-info">
        Manage internal users for your store: <a class="alert-link" href="~/Seller/Team">Open team management</a>.
    </div>
}

@if (!string.Equals(Model.AccountStatus, AccountStatuses.Verified, StringComparison.OrdinalIgnoreCase))
{
    <div class="alert alert-warning">
        Your email is not verified yet. Please confirm your address from the verification email to unlock seller tools.
    </div>
}

@if (Model.NeedsOnboarding)
{
    <div class="alert alert-warning">
        Finish your onboarding wizard to activate your store profile. <a class="alert-link" href="~/Seller/Onboarding">Resume onboarding</a>.
    </div>
}
else if (Model.OnboardingPendingReview)
{
    <div class="alert alert-info">
        Store profile submitted and pending verification. We will notify you when it's approved.
    </div>
}

@if (Model.NeedsKyc)
{
    <div class="alert alert-warning">
        Complete KYC to publish products and access payouts. <a class="alert-link" href="~/Seller/Kyc">Start KYC</a>.
    </div>
}
else
{
    <div class="alert alert-success">
        KYC is up to date. You have full access to seller capabilities.
    </div>
}

@if (!Model.HasValidPayoutSettings)
{
    <div class="alert alert-warning">
        Set up payout details so we can transfer your earnings. <a class="alert-link" href="~/Seller/PayoutSettings">Configure payout settings</a>.
    </div>
}
else
{
    <div class="alert alert-info">
        Payouts will use @Model.PayoutMethod on a @Model.PayoutSchedule schedule. <a class="alert-link" href="~/Seller/PayoutSettings">Update payout preferences</a>.
    </div>
}

<div class="card shadow-sm mt-3">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
            <div>
                <h2 class="h5 mb-1">Store profile</h2>
                <p class="text-muted mb-2">Buyers will see these details on your public page.</p>
            </div>
            <div class="d-flex gap-2">
                <a class="btn btn-primary btn-sm" href="~/Seller/StoreSettings">Manage store profile</a>
                @if (Model.HasStoreProfile)
                {
                    <a class="btn btn-outline-secondary btn-sm" asp-page="/Store/Details" asp-route-storeName="@Model.StoreName">View public store</a>
                }
            </div>
        </div>

        @if (Model.HasStoreProfile)
        {
            <div class="row align-items-center mt-3">
                <div class="col-md-3">
                    @if (!string.IsNullOrEmpty(Model.StoreLogoPath))
                    {
                        <img src="@Model.StoreLogoPath" alt="Store logo" class="img-fluid rounded border" />
                    }
                    else
                    {
                        <div class="text-muted small">No logo uploaded</div>
                    }
                </div>
                <div class="col-md-9">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">Name</dt>
                        <dd class="col-sm-8">@Model.StoreName</dd>
                        <dt class="col-sm-4">Description</dt>
                        <dd class="col-sm-8">@Model.StoreDescription</dd>
                        <dt class="col-sm-4">Contact email</dt>
                        <dd class="col-sm-8">@Model.ContactEmail</dd>
                        @if (!string.IsNullOrEmpty(Model.ContactPhone))
                        {
                            <dt class="col-sm-4">Phone</dt>
                            <dd class="col-sm-8">@Model.ContactPhone</dd>
                        }
                        @if (!string.IsNullOrEmpty(Model.ContactWebsite))
                        {
                            <dt class="col-sm-4">Website</dt>
                            <dd class="col-sm-8"><a href="@Model.ContactWebsite" target="_blank" rel="noopener">@Model.ContactWebsite</a></dd>
                        }
                    </dl>
                </div>
            </div>
        }
        else
        {
            <p class="mb-0 text-muted">Complete your store profile so buyers can reach you.</p>
        }
    </div>
</div>

<div class="card shadow-sm mt-3">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
            <div>
                <h2 class="h5 mb-1">Payout preferences</h2>
                <p class="text-muted mb-2">Default method and destination for your future payouts.</p>
            </div>
            <div class="d-flex gap-2">
                <a class="btn btn-primary btn-sm" href="~/Seller/PayoutSettings">Manage payout settings</a>
                <a class="btn btn-outline-secondary btn-sm" href="~/Seller/Payouts">View payout history</a>
                <a class="btn btn-outline-secondary btn-sm" href="~/Seller/Invoices">Commission invoices</a>
            </div>
        </div>
        <dl class="row mb-0 mt-2">
            <dt class="col-sm-4">Default method</dt>
            <dd class="col-sm-8">@Model.PayoutMethod</dd>
            <dt class="col-sm-4">Payout schedule</dt>
            <dd class="col-sm-8">@Model.PayoutSchedule</dd>
            @if (!string.IsNullOrEmpty(Model.MaskedBankAccount))
            {
                <dt class="col-sm-4">Bank account</dt>
                <dd class="col-sm-8">@Model.MaskedBankAccount</dd>
            }
            @if (!string.IsNullOrEmpty(Model.MaskedPayoutAccount))
            {
                <dt class="col-sm-4">Payout account</dt>
                <dd class="col-sm-8">@Model.MaskedPayoutAccount</dd>
            }
            <dt class="col-sm-4">Payout status</dt>
            <dd class="col-sm-8">@Model.PayoutStatus (eligible @Model.PayoutEligibleAmount:C, paid @Model.PayoutPaidAmount:C, threshold @Model.PayoutThreshold:C)</dd>
        </dl>
        @if (!Model.HasValidPayoutSettings)
        {
            <p class="text-danger mb-0">Payouts are blocked until required details are completed.</p>
        }
        else if (!string.IsNullOrEmpty(Model.PayoutErrorReference))
        {
            <p class="text-danger mb-0">Last payout failed: @Model.PayoutErrorReference. Fix your payout details and retry.</p>
        }
    </div>
</div>
