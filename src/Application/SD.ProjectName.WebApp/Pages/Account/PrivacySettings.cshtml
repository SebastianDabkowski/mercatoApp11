@page
@model SD.ProjectName.WebApp.Pages.Account.PrivacySettingsModel
@{
    ViewData["Title"] = "Privacy settings";
}

<h1>@ViewData["Title"]</h1>
<p class="text-muted">Review and adjust your communication and data processing consents.</p>

@if (!string.IsNullOrWhiteSpace(Model.StatusMessage))
{
    <div class="alert alert-success" role="alert">@Model.StatusMessage</div>
}

<form method="post" class="card">
    <div class="card-header">
        Consent preferences
    </div>
    <div class="card-body">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        @if (Model.ActiveConsents.Count == 0)
        {
            <p class="mb-0">No consent types are configured yet.</p>
        }
        else
        {
            @for (var i = 0; i < Model.ActiveConsents.Count; i++)
            {
                var consent = Model.ActiveConsents[i];
                <div class="form-check mb-3">
                    <input type="hidden" asp-for="Consents[i].Type" value="@consent.Type" />
                    <input class="form-check-input" asp-for="Consents[i].Accepted" />
                    <label class="form-check-label" asp-for="Consents[i].Accepted">
                        <strong>@consent.Title</strong>
                        <span class="d-block text-muted small">@consent.Description</span>
                        <span class="d-block text-muted small">Active version @consent.VersionTag (@consent.VersionEffectiveFrom?.ToString("yyyy-MM-dd") ?? "n/a")</span>
                        @if (consent.LastUpdatedOn.HasValue)
                        {
                            <span class="d-block text-muted small">Last decision @consent.LastUpdatedOn.Value.ToString("yyyy-MM-dd HH:mm") (version @consent.LastVersionTag ?? "n/a")</span>
                        }
                    </label>
                </div>
            }
        }
    </div>
    <div class="card-footer text-end">
        <button type="submit" class="btn btn-primary">Save changes</button>
    </div>
</form>

<form method="post" asp-page-handler="Export" class="card mt-4">
    <div class="card-header">
        Data export
    </div>
    <div class="card-body">
        <p class="mb-3">Download a ZIP file with your personal data in JSON format, including your profile, consent choices, saved addresses, and orders/messages.</p>
    </div>
    <div class="card-footer text-end">
        <button type="submit" class="btn btn-outline-primary">Download my data</button>
    </div>
</form>

<form method="post" asp-page-handler="Delete" class="card mt-4">
    <div class="card-header">
        Delete account
    </div>
    <div class="card-body">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <p class="mb-3 text-danger">Deleting your account is permanent. Your login will be disabled, personal details will be anonymized, and you will lose access to your data. Order and financial history will be retained in an anonymized form.</p>
        <p class="mb-3">You cannot delete your account while you have active orders or open disputes.</p>
        <div class="form-check">
            <input class="form-check-input" asp-for="ConfirmDeletion" />
            <label class="form-check-label" asp-for="ConfirmDeletion">
                I understand the impact and want to permanently delete my account.
            </label>
        </div>
    </div>
    <div class="card-footer text-end">
        <button type="submit" class="btn btn-danger">Delete my account</button>
    </div>
</form>
